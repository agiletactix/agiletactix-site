---
// Kit.com Modal Component for Blueprint Download
// This modal is triggered by "Download Blueprint" buttons on the blueprint page
---

<!-- Modal Backdrop and Container -->
<div
  id="kit-modal"
  class="fixed inset-0 z-50 hidden"
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
>
  <!-- Backdrop -->
  <div
    id="modal-backdrop"
    class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity backdrop-blur-sm"
    aria-hidden="true"
  ></div>

  <!-- Modal Panel -->
  <div class="fixed inset-0 overflow-y-auto">
    <div class="flex min-h-full items-center justify-center p-4 sm:p-6 lg:p-8">
      <div
        id="modal-panel"
        class="relative w-full max-w-lg transform overflow-hidden rounded-2xl bg-white shadow-2xl transition-all"
      >
        <!-- Close Button -->
        <button
          id="modal-close-button"
          type="button"
          class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-lg p-2 z-10"
          aria-label="Close modal"
        >
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>

        <!-- Modal Content -->
        <div class="px-6 py-8 sm:px-10 sm:py-12">
          <!-- Modal Header -->
          <div class="text-center mb-8">
            <h2 id="modal-title" class="text-3xl font-bold text-gray-900 mb-3">
              Download Your Agile-AI Blueprint
            </h2>
            <p class="text-lg text-gray-600">
              Join 13,000+ professionals who've learned from this instructor
            </p>
          </div>

          <!-- Benefit Statement -->
          <div class="mb-8 bg-primary-50 border border-primary-200 rounded-lg p-6">
            <p class="text-gray-700 text-center">
              Enter your email and get instant access to the Blueprint PDF. No credit card required.
            </p>
          </div>

          <!-- KIT.COM FORM EMBED SECTION -->
          <!--
            INSTRUCTIONS FOR ADDING KIT.COM FORM:

            1. Go to Kit.com (formerly ConvertKit)
            2. Create a new form for "Agile-AI Blueprint Download"
            3. Form should collect: Email (required), First Name (optional)
            4. Get the embed code - should look like:
               <script async data-uid="YOUR-FORM-ID" src="https://your-kit-subdomain.ck.page/YOUR-FORM-ID/index.js"></script>
            5. Paste the embed code below, replacing this entire comment block
            6. The form will automatically inherit the custom styling defined in the CSS below
            7. Configure Kit automation to send download link to Blueprint PDF upon form submission

            FORM REQUIREMENTS:
            - Single email input field
            - Optional first name field
            - Submit button labeled "Send Me the Blueprint" or "Download Now"
            - Success message: "Check your email! Your Blueprint is on its way."

            The custom CSS below will style your Kit form to match the site design.
          -->

          <div class="kit-form-container">
            <!-- Kit.com embed code goes here -->
            <div class="placeholder-content bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-8">
              <div class="text-center">
                <svg class="h-12 w-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <p class="text-gray-600 mb-4 font-medium">Kit.com form will be embedded here</p>
                <div class="text-sm text-gray-500 text-left max-w-xs mx-auto">
                  <p class="font-semibold mb-2">Form should include:</p>
                  <ul class="list-disc list-inside space-y-1">
                    <li>Email input field (required)</li>
                    <li>First name field (optional)</li>
                    <li>Submit button: "Send Me the Blueprint"</li>
                    <li>Success message handling</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <!-- END KIT.COM FORM EMBED SECTION -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Custom CSS for Kit.com Form Styling -->
<style is:global>
  /* Custom styles for Kit.com form elements to match site design */

  .kit-form-container {
    @apply w-full;
  }

  /* Main form container */
  .kit-form-container .formkit-form {
    @apply w-full;
  }

  /* Form field wrappers */
  .kit-form-container .formkit-field,
  .kit-form-container .formkit-fields {
    @apply mb-4;
  }

  /* Input fields */
  .kit-form-container input[type="email"],
  .kit-form-container input[type="text"] {
    @apply w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200;
  }

  /* Input focus state */
  .kit-form-container input[type="email"]:focus,
  .kit-form-container input[type="text"]:focus {
    @apply shadow-md;
  }

  /* Submit button */
  .kit-form-container button[type="submit"],
  .kit-form-container .formkit-submit {
    @apply w-full bg-primary-600 text-white px-6 py-4 rounded-lg font-semibold text-lg shadow-md hover:bg-primary-700 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-all duration-200 cursor-pointer;
  }

  /* Submit button hover state */
  .kit-form-container button[type="submit"]:hover,
  .kit-form-container .formkit-submit:hover {
    @apply transform -translate-y-0.5;
  }

  /* Error messages */
  .kit-form-container .formkit-error,
  .kit-form-container [data-element="errors"] {
    @apply text-red-600 text-sm mt-2;
  }

  /* Input error state */
  .kit-form-container input.formkit-error,
  .kit-form-container input[aria-invalid="true"] {
    @apply border-red-500 focus:ring-red-500;
  }

  /* Success messages */
  .kit-form-container .formkit-alert,
  .kit-form-container .formkit-alert-success,
  .kit-form-container [data-element="success"] {
    @apply bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg text-center font-medium;
  }

  /* Labels */
  .kit-form-container label {
    @apply block text-sm font-medium text-gray-700 mb-2;
  }

  /* Powered by Kit link (make it subtle) */
  .kit-form-container .formkit-powered-by {
    @apply text-xs text-gray-400 text-center mt-4;
  }

  .kit-form-container .formkit-powered-by a {
    @apply text-gray-500 hover:text-gray-700;
  }
</style>

<!-- Modal JavaScript -->
<script>
  // Wait for DOM to be ready
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('kit-modal');
    const modalPanel = document.getElementById('modal-panel');
    const backdrop = document.getElementById('modal-backdrop');
    const closeButton = document.getElementById('modal-close-button');
    const openButtons = document.querySelectorAll('[data-modal-trigger="blueprint"]');

    if (!modal || !modalPanel || !backdrop || !closeButton) return;

    let lastFocusedElement: HTMLElement | null = null;

    // Function to open modal
    function openModal() {
      if (!modal || !modalPanel || !backdrop) return;

      lastFocusedElement = document.activeElement as HTMLElement;
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';

      // Animate in
      setTimeout(() => {
        if (!backdrop || !modalPanel) return;
        backdrop.style.opacity = '1';
        modalPanel.style.opacity = '1';
        modalPanel.style.transform = 'translateY(0)';
      }, 10);

      // Focus first input field
      const firstInput = modal.querySelector('input') as HTMLElement;
      if (firstInput) {
        setTimeout(() => firstInput.focus(), 100);
      }

      // Trap focus within modal
      trapFocus(modal);
    }

    // Function to close modal
    function closeModal() {
      if (!modal || !modalPanel || !backdrop) return;

      backdrop.style.opacity = '0';
      modalPanel.style.opacity = '0';
      modalPanel.style.transform = 'translateY(20px)';

      setTimeout(() => {
        if (!modal) return;
        modal.classList.add('hidden');
        document.body.style.overflow = '';

        // Return focus to the button that opened the modal
        if (lastFocusedElement) {
          lastFocusedElement.focus();
        }
      }, 200);
    }

    // Add click handlers to all trigger buttons
    openButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        e.preventDefault();
        openModal();
      });
    });

    // Close button
    closeButton.addEventListener('click', closeModal);

    // Close on backdrop click
    backdrop.addEventListener('click', closeModal);

    // Close on ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeModal();
      }
    });

    // Focus trap function
    function trapFocus(element: HTMLElement) {
      const focusableElements = element.querySelectorAll(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      );
      const firstFocusable = focusableElements[0] as HTMLElement;
      const lastFocusable = focusableElements[focusableElements.length - 1] as HTMLElement;

      element.addEventListener('keydown', (e) => {
        if (e.key !== 'Tab') return;

        if (e.shiftKey) {
          if (document.activeElement === firstFocusable) {
            e.preventDefault();
            lastFocusable.focus();
          }
        } else {
          if (document.activeElement === lastFocusable) {
            e.preventDefault();
            firstFocusable.focus();
          }
        }
      });
    }
  });
</script>

<!-- Initial styles for animation -->
<style>
  #modal-backdrop {
    opacity: 0;
    transition: opacity 200ms ease-out;
  }

  #modal-panel {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 300ms ease-out, transform 300ms ease-out;
  }
</style>
